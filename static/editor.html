<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xlink="http://www.w3.org/1999/xlink">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="cache-control" content="no-cache">
<meta charset="utf-8">

<head>
<title>Junior</title>
<script src="./js/jquery.min.js"></script>
<script src="./js/jquery.cokie.min.js"></script>
<script src="./js/qiniu.min.js"></script>
<script src="./js/common.js"></script>
<script>
    var uploadParam = {}
    var workId = urlParams('workId')
    var unitId = urlParams('unitId')

    var observer = {
      next(res) { },
      error(err) {
        console.log(1, err)
      },
      complete(res) {
        console.log(res)
        if (res.key.includes('png')) {
          uploadParam.coverKey = uploadFile(res.key, '学生作业-封面', res.key)
        } else {
          uploadParam.projectKey = uploadFile(res.key, '学生作业-sjr', res.key)
        }
        if (uploadParam.projectKey && uploadParam.coverKey) {
          //uploadWork(uploadParam.projectKey, uploadParam.coverKey, uploadParam.projectTitle)
        }
      }
    }


    window.scratchJrPage = 'editor';
    window.JrConfig = {
        onInit(){
          console.log("onInit")
          // window.ScratchJr.loadProjectSjr(url);
        },
        onLoaded: function(){
          console.log("onLoaded");
        },
        onSaveCloud: function(contents, name){
            console.log("content:" + contents);
            console.log(name);
            var uuid = window.uuid()
            uploadParam.projectTitle = name
            // upload2Qiniu(contents, 'scratchjr/' + uuid + '.sjr', name, observer)
            //获取封面
            window.ScratchJr.getProjectCover((r)=>{
                blob = dataURLtoBlob(r)
                //upload2Qiniu(blob, 'scratchjr/' + uuid + '.png', name, observer)
            })
            
        },
    }


</script>
<script type="text/javascript" src="app.bundle.js"></script>
</head>
<body style="background: white;">
<div class="frame" id="frame"></div>
<div class="libframe" id="libframe"></div>
<div class="paintframe" id="paintframe"></div>

</body>
</html>
